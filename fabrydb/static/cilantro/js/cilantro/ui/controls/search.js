define(["jquery","underscore","marionette","./base","../../models","../../constants","../paginator","../values","../search"],function(t,e,i,n,o,s,r,a,l){var c=o.Page.extend({constructor:function(t,e){(e=e||{}).parse=!0,this.items=new o.Values,o.Page.prototype.constructor.call(this,t,e)},parse:function(t,e){return this.items.reset(t.values,e),delete t.values,t}}),u=o.Paginator.extend({model:c,initialize:function(t,e){e=e||{},this.field=e.field,o.Paginator.prototype.initialize.call(this,t,e)},url:function(){var e=this.field.links.values;return this.urlParams&&(e=e+"?"+t.param(this.urlParams)),e}}),h=l.Search.extend({className:"field-search search",initialize:function(){l.Search.prototype.initialize.call(this),this.paginator=this.options.paginator},search:function(t){t?this.options.paginator.urlParams={query:t}:this.paginator.urlParams=null,this.paginator.refresh()}}),d=i.ItemView.extend({className:"value-item",template:"controls/search/item",ui:{actions:".actions",addButton:".add-item-button",removeButton:".remove-item-button"},events:{"click .add-item-button":"addItem","click .remove-item-button":"removeItem"},constructor:function(t){t=t||{},(this.values=t.values)&&(this.listenTo(this.values,"add",this.setState),this.listenTo(this.values,"remove",this.setState),this.listenTo(this.values,"reset",this.setState)),i.ItemView.prototype.constructor.call(this,t)},addItem:function(){var t=e.extend(this.model.toJSON(),{valid:!0});this.values.add(t)},removeItem:function(){this.values.remove(this.model)},setState:function(){this.values.get(this.model)?(this.ui.addButton.hide(),this.ui.removeButton.show()):(this.ui.addButton.show(),this.ui.removeButton.hide())},onRender:function(){this.setState()}}),p=r.ListingPage.extend({className:"search-value-list",itemView:d}),f=r.PageRoll.extend({listView:p}),g=n.ControlLayout.extend({className:"field-value-search",template:"controls/search/layout",searchPaginator:u,regions:{search:".search-region",paginator:".paginator-region",browse:".browse-region",values:".values-region"},regionViews:{search:h,paginator:r.Paginator,browse:f,values:a.ValueList},initialize:function(){if(!this.collection){this.collection=new o.Values;var t=this;this.collection.url=function(){return t.model.links.values}}this.listenTo(this.collection,"all",this.change),this.valuesPaginator=new this.searchPaginator(null,{field:this.model}),this.valuesPaginator.refresh()},onRender:function(){var t=new this.regionViews.search({model:this.model,paginator:this.valuesPaginator,placeholder:"Search "+this.model.get("plural_name")+"..."}),e=new this.regionViews.browse({collection:this.valuesPaginator,values:this.collection}),i=new this.regionViews.paginator({className:"paginator mini",model:this.valuesPaginator}),n=new this.regionViews.values({collection:this.collection});this.search.show(t),this.browse.show(e),this.paginator.show(i),this.values.show(n)},getField:function(){return this.model?this.model.id:void 0},getOperator:function(){return"in"},getValue:function(){return this.collection.toJSON()},setValue:function(t){this.collection.set(t,{merge:!1})},validate:function(){var t,e=[];return(t=this.collection.any(function(t){return t.get("pending")===!0}))?"The values are being checked, please wait a few seconds then click &quot;Apply Filter&quot; again.":(this.collection.each(function(t){t.get("valid")||e.push(t.get("label"))}),e.length?"Remove the following invalid labels then click &quot;Apply Filter&quot; again: "+e.join(", "):void 0)}});return{SearchControl:g,ValueSearch:h,SearchItem:d,SearchPage:p,SearchPageRoll:f,SearchPaginator:u}});
//@ sourceMappingURL=search.js.map